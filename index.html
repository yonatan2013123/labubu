<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>קניית מוצרי Labubu</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to right, #c6ffdd, #fbd786, #f7797d);
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #333;
      color: white;
      padding: 10px;
      text-align: center;
    }
    main {
      padding: 20px;
    }
    .product {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      padding: 20px;
      margin-bottom: 20px;
      text-align: center;
    }
    .product img {
      max-width: 100%;
      height: auto;
      border-radius: 10px;
    }
    .price {
      color: #e91e63;
      font-size: 24px;
      margin: 10px 0;
    }
    .buy-btn, #checkout-btn {
      background-color: #e91e63;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
      margin: 5px;
    }
    .buy-btn:hover, #checkout-btn:hover {
      background-color: #d81b60;
    }
    .profile-section {
      background-color: #fff;
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      margin-top: 20px;
      text-align: right;
    }
    .circle {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background-color: #2196f3;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: bold;
      float: left;
      margin-left: 10px;
    }
    #registration-section {
      background-color: #fff;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      text-align: center;
    }
    input {
      padding: 10px;
      font-size: 16px;
      margin: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
      width: 80%;
      max-width: 300px;
    }
    #checkout-container {
      text-align: center;
      margin-top: 15px;
    }
    .remove-btn {
      background: transparent;
      border: none;
      color: #e91e63;
      font-weight: bold;
      font-size: 18px;
      cursor: pointer;
      margin-left: 10px;
    }
    .remove-btn:hover {
      color: #d81b60;
    }
  </style>
</head>
<body>
  <header>
    <h1>ברוכים הבאים ל-Labubu</h1>
  </header>
  <main>
    <div id="registration-section" style="display: none;">
      <h2>הרשמה</h2>
      <input type="email" id="email-input" placeholder="הכנס אימייל" required /><br />
      <button class="buy-btn" onclick="sendCode()">שלח קוד</button>
      <div id="code-section" style="display:none; margin-top: 10px;">
        <input type="text" id="code-input" placeholder="הכנס קוד אימות" maxlength="6" />
        <button class="buy-btn" onclick="verifyCode()">אמת</button>
      </div>
    </div>

    <div class="product">
      <h2>בובת labubu רק למנויים</h2>
      <p>מחיר: <span class="price">120₪</span></p>
      <button class="buy-btn" id="buy-btn-120" style="display:none;" onclick="window.location.href='https://www.paypal.com/ncp/payment/8S42RNMGBWWGW'">לקנייה</button>
      <button class="buy-btn" onclick="addToCart('בובת labubu למנויים', 120)">הוסף לסל</button>
    </div>

    <div class="product">
      <img src="A64D8C50-A7D8-4646-8B66-74C1359804FC.png" alt="בובת מיסטרי פרימיום" />
      <h2>labubu ללא מנוי</h2>
      <p>מחיר: <span class="price">150₪</span></p>
      <button class="buy-btn" onclick="window.location.href='https://www.paypal.com/ncp/payment/JV4CVR92BULG2'">לקנייה</button>
      <button class="buy-btn" onclick="addToCart('בובת labubu רגילה', 150)">הוסף לסל</button>
    </div>

    <div class="profile-section" style="display:none;" id="profile-section">
      <div class="circle" id="profile-initial"></div>
      <div>
        <p><strong>אימייל:</strong> <span id="profile-email"></span></p>
        <p><strong>🛒 עגלה:</strong> <span id="cart-items-count">0</span> פריטים</p>
        <h3>היסטוריית רכישות:</h3>
        <ul id="purchase-history"></ul>
      </div>
      <div style="clear: both;"></div>
    </div>

    <div id="checkout-container" style="display:none;">
      <button id="checkout-btn" onclick="checkout()">לתשלום</button>
    </div>
  </main>
  <script>
    function addToCart(itemName, price) {
      let cart = JSON.parse(localStorage.getItem('cartItems') || '[]');
      cart.push({ name: itemName, price: price });
      localStorage.setItem('cartItems', JSON.stringify(cart));
      alert(itemName + " נוסף לעגלה!");
      updateCartAndHistory();
      toggleCheckoutButton();
    }

    function removeFromCart(index) {
      let cart = JSON.parse(localStorage.getItem('cartItems') || '[]');
      cart.splice(index, 1);
      localStorage.setItem('cartItems', JSON.stringify(cart));
      updateCartAndHistory();
      toggleCheckoutButton();
    }

    function updateCartAndHistory() {
      const cart = JSON.parse(localStorage.getItem('cartItems') || '[]');
      document.getElementById('cart-items-count').textContent = cart.length;
      const ul = document.getElementById('purchase-history');
      ul.innerHTML = '';
      let total = 0;
      cart.forEach((item, index) => {
        const li = document.createElement('li');
        li.textContent = item.name + ' - ₪' + item.price;
        
        // יצירת כפתור מחיקה
        const removeBtn = document.createElement('button');
        removeBtn.textContent = '❌';
        removeBtn.className = 'remove-btn';
        removeBtn.title = "הסר מהעגלה";
        removeBtn.onclick = () => removeFromCart(index);
        li.appendChild(removeBtn);

        ul.appendChild(li);
        total += item.price;
      });
      if (cart.length > 0) {
        const totalLi = document.createElement('li');
        totalLi.style.fontWeight = 'bold';
        totalLi.textContent = 'סה"כ: ₪' + total;
        ul.appendChild(totalLi);
      }
    }

    function sendCode() {
      const email = document.getElementById('email-input').value.trim();

      if (!email.includes('@')) {
        alert('נא להכניס אימייל תקין');
        return;
      }
      const code = Math.floor(100000 + Math.random() * 900000).toString();
      localStorage.setItem('verificationCode', code);
      localStorage.setItem('pendingEmail', email);
      alert('קוד האימות שלך הוא: ' + code);
      document.getElementById('code-section').style.display = 'block';
    }

    function verifyCode() {
      const enteredCode = document.getElementById('code-input').value.trim();
      const actualCode = localStorage.getItem('verificationCode');
      if (enteredCode === actualCode) {
        const email = localStorage.getItem('pendingEmail');
        localStorage.setItem('userEmail', email);
        alert('נרשמת בהצלחה!');
        location.reload();
      } else {
        alert('קוד שגוי');
      }
    }

    function toggleCheckoutButton() {
      const cart = JSON.parse(localStorage.getItem('cartItems') || '[]');
      const checkoutContainer = document.getElementById('checkout-container');
      if (cart.length > 0) {
        checkoutContainer.style.display = 'block';
      } else {
        checkoutContainer.style.display = 'none';
      }
    }

    function checkout() {
      const cart = JSON.parse(localStorage.getItem('cartItems') || '[]');
      if (cart.length === 0) {
        alert("העגלה ריקה!");
        return;
      }
      let total = 0;
      cart.forEach(item => {
        total += item.price;
      });
      // כאן תשים את כתובת התשלום שלך ב-PayPal או שירות אחר
      // לצורך הדוגמה, נבנה לינק פשוט ל-PayPal עם סכום כולל:
      const paypalUrl = `https://www.paypal.com/cgi-bin/webscr?cmd=_xclick&business=your-email@example.com&currency_code=ILS&amount=${total}`;
      window.open(paypalUrl, '_blank');
    }

    const email = localStorage.getItem("userEmail");
    if (email) {
      const firstLetter = email.charAt(0).toUpperCase();
      document.getElementById("profile-initial").textContent = firstLetter;
      document.getElementById("profile-email").textContent = email;
      document.getElementById("registration-section").style.display = "none";
      document.getElementById("profile-section").style.display = "block";
    } else {
      document.getElementById("registration-section").style.display = "block";
      document.getElementById("profile-section").style.display = "none";
    }

    updateCartAndHistory();
    toggleCheckoutButton();
  </script>
</body>
</html>
